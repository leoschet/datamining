<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-MC35ML');</script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual:  GPU instancing</title>
<meta name="description" content="The Unity Manual helps you learn and use the Unity engine. With the Unity engine you can create 2D and 3D games, apps and experiences.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1503756017"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1503756017"></script><script type="text/javascript" src="docdata/toc.js?ts=1503756017"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1503756017"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1503756017">
</head>
<body>
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="https://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="https://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-number">Version: <b>2017.1</b> (<a href="https://docs.unity3d.com/2017.2/Documentation/Manual">switch to 2017.2b</a>)</div>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/GPUInstancing.html">English</a></li>
<li><a href="/ja/current/Manual/GPUInstancing.html">日本語</a></li>
<li><a href="/es/current/Manual/GPUInstancing.html">Español</a></li>
<li><a href="/kr/current/Manual/GPUInstancing.html">한국어</a></li>
<li><a href="/ru/current/Manual/GPUInstancing.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (2017.1)</a></li>
<li><a href="Graphics.html">Graphics</a></li>
<li><a href="GraphicsOverview.html">Graphics Overview</a></li>
<li>Advanced Rendering Features</li>
<li> GPU instancing</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="GraphicsCommandBuffers.html"></a></span><div class="tip"> Graphics Command Buffers</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SparseTextures.html"></a></span><div class="tip">Sparse Textures</div>
</div>
</div></div>
<div class="otherversionswrapper" onmouseover="setOtherVersionsDisplay(true)" onmouseout="setOtherVersionsDisplay(false)">
<a>Other Versions</a><div class="otherversionscontent" id="OtherVersionsContent" style="display: none;">Cannot access other versions offline!</div>
</div>
<h1>GPU instancing</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<h2>Introduction</h2>

<p>Use GPU Instancing to draw (or render) multiple copies of the same Mesh at once, using a small number of <a href="DrawCallBatching.html">draw calls</a>. It is useful for drawing objects such as buildings, trees and grass, or other things that appear repeatedly in a Scene. </p>

<p>GPU Instancing only renders identical Meshes with each draw call, but each instance can have different parameters (for example, color or scale) to add variation and reduce the appearance of repetition. </p>

<p>GPU Instancing can reduce the number of draw calls used per Scene. This significantly improves the rendering performance of your project.</p>

<h2>Adding instancing to your Materials</h2>

<p>To enable GPU Instancing on Materials, select your Material in the Project window, and in the Inspector, tick the <strong>Enable Instancing</strong> checkbox.</p>

<figure>
<img src="../uploads/Main/GPUInstancing-0.png" alt="The Enable Instancing checkbox as it appears in the Material Inspector window">
<figcaption>The <strong>Enable Instancing</strong> checkbox as it appears in the Material Inspector window</figcaption>
</figure>

<p>Unity only displays this checkbox if the Material Shader supports GPU Instancing. This includes Standard, StandardSpecular and all surface <a href="Shaders.html">Shaders</a>. See documentation on <a href="shader-StandardShader.html">standard Shaders</a> for more information.</p>

<p>The screenshots below show the same Scene with multiple GameObjects; in the top image GPU Instancing is enabled, in the bottom image it is not. Note the difference in <strong>FPS</strong>, <strong>Batches </strong>and <strong>Saved by batching</strong>.</p>

<figure>
<img src="../uploads/Main/GPUInstancing-1.png" alt="With GPU Instancing: A simple Scene that includes multiple identical GameObjects that have GPU Instancing enabled">
<figcaption>With GPU Instancing: A simple Scene that includes multiple identical GameObjects that have GPU Instancing enabled</figcaption>
</figure>

<figure>
<img src="../uploads/Main/GPUInstancing-2.png" alt="No GPU Instancing: A simple Scene that includes multiple identical GameObjects that do not have GPU Instancing enabled.">
<figcaption>No GPU Instancing: A simple Scene that includes multiple identical GameObjects that do not have GPU Instancing enabled.</figcaption>
</figure>

<p>When you use GPU instancing, the following restrictions apply:</p>

<ul>
<li><p>Unity automatically picks MeshRenderer components and <code>Graphics.DrawMesh</code> calls for instancing. Note that <a href="https://docs.unity3d.com/ScriptReference/SkinnedMeshRenderer.html">SkinnedMeshRenderer</a> is not supported.</p></li>
<li><p>Unity only batches GameObjects that share the same Mesh and the same Material in a single GPU instancing draw call. Use a small number of Meshes and Materials for better instancing efficiency. To create variations, modify your shader scripts to add per-instance data (see next section to learn more about this).</p></li>
</ul>

<p>You can also use the calls <a href="../ScriptReference/Graphics.DrawMeshInstanced.html">Graphics.DrawMeshInstanced</a> and <a href="../ScriptReference/Graphics.DrawMeshInstancedIndirect.html">Graphics.DrawMeshInstancedIndirect</a>. to perform GPU Instancing from your scripts.</p>

<p>GPU Instancing is available on the following platforms and APIs:</p>

<ul>
<li><p>
<strong>DirectX 11</strong> and <strong>DirectX 12</strong> on Windows</p></li>
<li><p>
<strong>OpenGL Core 4.1+/ES3.0+</strong> on Windows, macOS, Linux, iOS and Android</p></li>
<li><p>
<strong>Metal</strong> on macOS and iOS</p></li>
<li><p>
<strong>Vulkan</strong> on Windows and Android</p></li>
<li><p>
<strong>PlayStation 4</strong> and <strong>Xbox One</strong>
</p></li>
<li><p>
<strong>WebGL</strong> (requires WebGL 2.0 API)</p></li>
</ul>

<h2>Adding per-instance data</h2>

<p>By default, Unity only batches instances of GameObjects with different <a href="Transforms.html">Transforms</a> in each instanced draw call. To add more variance to your instanced GameObjects, modify your Shader to add per-instance properties such as Material color. </p>

<p>The example below demonstrates how to create an instanced Shader with different colour values for each instance.</p>

<pre><code>
Shader &quot;Custom/InstancedColorSurfaceShader&quot; {
    Properties {
        _Color (&quot;Color&quot;, Color) = (1,1,1,1)
        _MainTex (&quot;Albedo (RGB)&quot;, 2D) = &quot;white&quot; {}
        _Glossiness (&quot;Smoothness&quot;, Range(0,1)) = 0.5
        _Metallic (&quot;Metallic&quot;, Range(0,1)) = 0.0
    }

    SubShader {
        Tags { &quot;RenderType&quot;=&quot;Opaque&quot; }
        LOD 200
        CGPROGRAM
        // Physically based Standard lighting model, and enable shadows on all light types
        #pragma surface surf Standard fullforwardshadows
        // Use Shader model 3.0 target
        #pragma target 3.0
        sampler2D _MainTex;
        struct Input {
            float2 uv_MainTex;
        };
        half _Glossiness;
        half _Metallic;
        UNITY_INSTANCING_CBUFFER_START(Props)
           UNITY_DEFINE_INSTANCED_PROP(fixed4, _Color)
        UNITY_INSTANCING_CBUFFER_END
        void surf (Input IN, inout SurfaceOutputStandard o) {
            fixed4 c = tex2D (_MainTex, IN.uv_MainTex) * UNITY_ACCESS_INSTANCED_PROP(_Color);
            o.Albedo = c.rgb;
            o.Metallic = _Metallic;
            o.Smoothness = _Glossiness;
            o.Alpha = c.a;
        }
        ENDCG
    }
    FallBack &quot;Diffuse&quot;
}

</code></pre>

<p>When you declare <code>_Color</code> as an instanced property, Unity takes all <code>_Color</code> GameObjects that share a Mesh and Material and includes them in a single draw call.</p>

<pre><code>
MaterialPropertyBlock props = new MaterialPropertyBlock();
MeshRenderer renderer;

foreach (GameObject obj in objects)
{
   float r = Random.Range(0.0f, 1.0f);
   float g = Random.Range(0.0f, 1.0f);
   float b = Random.Range(0.0f, 1.0f);
   props.SetColor(&quot;_Color&quot;, new Color(r, g, b));
   
   renderer = obj.GetComponent&lt;MeshRenderer&gt;();
   renderer.SetPropertyBlock(props);
}
</code></pre>

<p>For these changes to take effect, you must enable GPU Instancing. To do this, select your Shader in the Project window, and in the Inspector, tick the <strong>Enable Instancing</strong> checkbox.</p>

<figure>
<img src="../uploads/Main/GPUInstancing-3.png" alt="The Enable Instancing checkbox as shown in the Shader Inspector window">
<figcaption>The Enable Instancing checkbox as shown in the Shader Inspector window</figcaption>
</figure>

<h2>Adding instancing to vertex and fragment Shaders</h2>

<p>The following example takes a simple unlit Shader and makes it capable of instancing with different colors:</p>

<pre><code>
Shader &quot;SimplestInstancedShader&quot;
{
    Properties
    {
        _Color (&quot;Color&quot;, Color) = (1, 1, 1, 1)
    }

    SubShader
    {
        Tags { &quot;RenderType&quot;=&quot;Opaque&quot; }
        LOD 100

        Pass
        {
            CGPROGRAM
            #pragma vertex vert
            #pragma fragment frag
            #pragma multi_compile_instancing
            #include &quot;UnityCG.cginc&quot;

            struct appdata
            {
                float4 vertex : POSITION;
                UNITY_VERTEX_INPUT_INSTANCE_ID
            };

            struct v2f
            {
                float4 vertex : SV_POSITION;
                UNITY_VERTEX_INPUT_INSTANCE_ID // necessary only if you want to access instanced properties in fragment Shader.
            };

            UNITY_INSTANCING_CBUFFER_START(MyProperties)
                UNITY_DEFINE_INSTANCED_PROP(float4, _Color)
            UNITY_INSTANCING_CBUFFER_END
           
            v2f vert(appdata v)
            {
                v2f o;

                UNITY_SETUP_INSTANCE_ID(v);
                UNITY_TRANSFER_INSTANCE_ID(v, o); // necessary only if you want to access instanced properties in the fragment Shader.

                o.vertex = UnityObjectToClipPos(v.vertex);
                return o;
            }
           
            fixed4 frag(v2f i) : SV_Target
            {
                UNITY_SETUP_INSTANCE_ID(i); // necessary only if any instanced properties are going to be accessed in the fragment Shader.
                return UNITY_ACCESS_INSTANCED_PROP(_Color);
            }
            ENDCG
        }
    }
}
</code></pre>

<h2>Shader modifications</h2>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Addition</th>
	<th style="text-align:left;">Function</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>#pragma multi_compile_instancing</code></td>
	<td style="text-align:left;">Use this to instruct Unity to generate instancing variants. It is not necessary for surface Shaders.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_VERTEX_INPUT_INSTANCE_ID</code></td>
	<td style="text-align:left;">Use this in the vertex Shader input/output structure to define an instance ID. See <code>SV_InstanceID</code> for more information.</td>
</tr>
<tr>
	<td style="text-align:left;">
<code>UNITY_INSTANCING_CBUFFER_START(name)</code> / <code>UNITY_INSTANCING_CBUFFER_EN</code>D</td>
	<td style="text-align:left;">Every per-instance property must be defined in a specially named constant buffer. Use this pair of macros to wrap the properties you want to be made unique to each instance.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_DEFINE_INSTANCED_PROP(float4, _Color)</code></td>
	<td style="text-align:left;">Use this to define a per-instance Shader property with a type and a name. In this example, the <code>_Color</code> property is unique.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_SETUP_INSTANCE_ID(v);</code></td>
	<td style="text-align:left;">Use this to make the instance ID accessible to Shader functions. It must be used at the very beginning of a vertex Shader, and is optional for fragment Shaders.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_TRANSFER_INSTANCE_ID(v, o);</code></td>
	<td style="text-align:left;">Use this to copy the instance ID from the input structure to the output structure in the vertex Shader. This is only necessary if you need to access per-instance data in the fragment Shader.</td>
</tr>
<tr>
	<td style="text-align:left;"><code>UNITY_ACCESS_INSTANCED_PROP(color)</code></td>
	<td style="text-align:left;">Use this to access a per-instance Shader property. It uses an instance ID to index into the instance data array.</td>
</tr>
</tbody>
</table>

<p>
<strong>Notes</strong>: </p>

<ul>
<li><p>When using multiple per-instance properties, you don’t need to fill all of them in <code>MaterialPropertyBlocks</code>.</p></li>
<li><p>If one instance lacks the property, Unity takes the default value from the referenced Material. If the material does not have a default value for the specified property, Unity sets the value to 0. Do not put non-instanced properties in the <code>MaterialPropertyBlock</code>, because this disables instancing. Instead, create different Materials for them.</p></li>
</ul>

<h2>Advanced GPU instancing tips</h2>

<h3>Batching priority</h3>

<p>When batching, Unity prioritizes <a href="DrawCallBatching.html">Static batching</a> over instancing. If you mark one of your GameObjects for static batching, and Unity successfully batches it, Unity disables instancing on that GameObject, even if its Renderer uses an instancing Shader. When this happens, the Inspector window displays a warning message suggesting that you disable Static Batching. To do this, open the Player Settings (<strong>Edit</strong> &gt; <strong>Project Settings</strong> &gt; <strong>Player</strong>), open <strong>Other Settings</strong>, and under the <strong>Rendering</strong> section, untick the <strong>Static Batching</strong> checkbox.</p>

<p>Unity prioritizes instancing over dynamic batching. If Unity can instance a Mesh, it disables dynamic batching for that Mesh.</p>

<h3>Graphics.DrawMeshInstanced</h3>

<p>Some factors can prevent GameObjects from being instanced together automatically. These factors include Material changes and depth sorting. Use <a href="../ScriptReference/Graphics.DrawMeshInstanced.html">Graphics.DrawMeshInstanced</a> to force Unity to draw these objects using GPU instancing. Like <a href="../ScriptReference/Graphics.DrawMesh.html">Graphics.DrawMesh</a>, this function draws Meshes for one frame without creating unnecessary GameObjects. </p>

<p>Do not submit batches of instances that exceed the <code>maxcount</code> specified in your Shader script (500 by default). When using graphics tools from <a href="https://www.opengl.org/">OpenGL</a> or <a href="https://developer.apple.com/metal/">Metal</a>, Unity divides the <code>maxcount</code> by 4, and uses the result as the maximum number of batches you can submit. The recommended practice for drawing arbitrary number of instances is to maintain a pool of pre-allocated 500-sized arrays (and <code>MaterialPropertyBlocks</code> if needed) and reuse these arrays as much as possible. See documentation on <a href="UnderstandingAutomaticMemoryManagement.html">Automatic Memory Management</a> for more information about object pooling.</p>

<h3>Graphics.DrawMeshInstancedIndirect</h3>

<p>Use <code>DrawMeshInstancedIndirect</code> in a script to read the parameters of instancing draw calls, including the number of instances, from a compute buffer. This is useful if you want to populate all of the instance data from the GPU, and the CPU does not know the number of instances to draw (for example, when performing GPU culling). See API documentation on <a href="../ScriptReference/Graphics.DrawMeshInstancedIndirect.html">Graphics.DrawMeshInstancedIndirect</a> for a detailed explanation and code examples.</p>

<h3>pragma instancing_options</h3>

<p>The <code>#pragma instancing_options</code> directive can use the following switches: </p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;"><strong>Switch</strong></th>
	<th style="text-align:left;"><strong>Function</strong></th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;"><code>maxcount: batchSize</code></td>
	<td style="text-align:left;">Use this to specify the maximum number of instances to draw in one instanced draw call. By default this value is 500. When using OpenGL or Metal, Unity divides the <code>maxcount</code> by 4, and uses the result as the maximum number of batches you can submit. Make this value as small as possible to match the amount of instances you want to draw. For example, to draw a maximum of 1000 instances, add <code>maxcount: 1000</code> to your shader script. Larger values increase Shader compilation time, and can reduce GPU performance.</td>
</tr>
</tbody>

<tbody>
<tr>
	<td style="text-align:left;"><code>force_same_maxcount_for_gl</code></td>
	<td style="text-align:left;">Use this to force Unity to stop dividing the maxcount by 4 on graphics tools from <a href="https://www.opengl.org/">OpenGL</a> or <a href="https://developer.apple.com/metal/">Metal</a>.</td>
</tr>
</tbody>

<tbody>
<tr>
	<td style="text-align:left;"><code>assumeuniformscaling</code></td>
	<td style="text-align:left;">Use this to instruct Unity to assume that all the instances have uniform scalings (the same scale for all X, Y and Z axes).</td>
</tr>
</tbody>

<tbody>
<tr>
	<td style="text-align:left;"><code>lodfade</code></td>
	<td style="text-align:left;">Use this to make <a href="LevelOfDetail.html">LOD</a> fade values instanceable. This is useful for <a href="SpeedTree.html">SpeedTree</a> and other LOD techniques that use the LOD fading feature.</td>
</tr>
</tbody>

<tbody>
<tr>
	<td style="text-align:left;"><code>procedural:FunctionName</code></td>
	<td style="text-align:left;">Use this to instruct Unity to generate an additional variant for use with <a href="../ScriptReference/DrawMeshInstancedIndirect.html">Graphics.DrawMeshInstancedIndirect</a>. <br>At the beginning of the vertex Shader stage, Unity calls the function specified after the colon. To set up the instance data manually, add per-instance data to this function in the same way you would normally add per-instance data to a Shader. Unity also calls this function at the beginning of a fragment Shader if any of the fetched instance properties are included in the fragment Shader.</td>
</tr>
</tbody>
</table>

<h3>UnityObjectToClipPos</h3>

<p>When writing shader scripts, always use <code>UnityObjectToClipPos(v.vertex)</code> instead of <code>mul(UNITY_MATRIX_MVP,v.vertex)</code>. </p>

<p>While you can continue to use <code>UNITY_MATRIX_MVP</code> as normal in instanced Shaders, <code>UnityObjectToClipPos</code> is the most efficient way to transform vertex positions from object space into clip space. Unity also implements a Shader upgrader that scans all your Shaders in the project, and automatically replaces any occurrence of <code>mul(UNITY_MATRIX_MVP, v)</code> with <code>UnityObjectToClipPos(v)</code>.</p>

<p>The console window (menu: <strong>Window</strong> &gt; <strong>Console</strong>) displays performance warnings if there are still places where <code>UNITY_MATRIX_MVP</code> (along with <code>UNITY_MATRIX_MV</code>) is used.</p>

<h2>Further notes</h2>

<ul>
<li><p>Surface Shaders have instancing variants generated by default, unless you specify <code>noinstancing</code> in the <code>#pragma</code> surface directive. Standard and StandardSpecular Shaders are already modified to have instancing support, but with no per-instance properties defined other than the transforms. Unity ignores uses of <code>#pragma multi_compile_instancing</code> in a surface Shader.</p></li>
<li><p>Unity strips instancing variants if GPU Instancing is not enabled on any GameObject in the Scene. To override the stripping behaviour, open the <a href="class-GraphicsSettings.html">Graphics Settings</a> (menu: <strong>Edit </strong>&gt; <strong>Project Settings</strong> &gt; <strong>Graphics</strong>), navigate to the <strong>Shader stripping</strong> section and change the <strong>Instancing Variants</strong>. </p></li>
<li><p>For <code>Graphics.DrawMeshInstanced</code>, you need to enable GPU Instancing on the Material that is being passed into this method. However, <code>Graphics.DrawMeshInstancedIndirect</code> does not require you to enable GPU Instancing. The indirect instancing keyword <code>PROCEDURAL_INSTANCING_ON</code> is not affected by stripping.</p></li>
<li><p>Instanced draw calls appear in the <a href="FrameDebugger.html">Frame Debugger</a> as <strong>Draw Mesh (instanced)</strong>.</p></li>
<li><p>You don’t always need to define per-instance properties. However, setting up an instance ID is mandatory, because world matrices need it to function correctly. Surface shaders automatically set up an instance ID. You must set up the instance ID for Custom Vertex and Fragment shaders manually. To do this, use <code>UNITY_SETUP_INSTANCE_ID</code> at the beginning of the Shader.</p></li>
<li><p>When using forward rendering, Unity cannot efficiently instance objects that are affected by multiple lights. Only the base pass can make effective use of instancing, not the added passes. For more information about lighting passes, see documentation on <a href="RenderTech-ForwardRendering.html">Forward Rendering</a> and <a href="SL-PassTags.html">Pass Tags</a>
</p></li>
<li><p>Objects that use lightmaps, or are affected by different light or <a href="class-ReflectionProbe.html">Reflection Probes</a>, can’t be instanced.</p></li>
<li><p>If you have more than two passes for multi-pass Shaders, only the first passes can be instanced. This is because Unity forces the later passes to be rendered together for each object, forcing Material changes.</p></li>
<li><p>All the Shader macros used in the above examples are defined in <em>UnityInstancing.cginc</em>. Find this file in the following directory: <em>[Unity installation folder]\Editor\Data\CGIncludes</em>.</p></li>
</ul>

<hr>

<ul>
<li><p><span class="page-edit">2017–05–18 Page amended with <a href="DocumentationEditorialReview.html">editorial review</a> - <a href="LeaveFeedback.html">Leave page feedback</a>
</span></p></li>
<li><p><span class="page-history">Enable instancing checkbox guidance, DrawMeshInstancedIndirect, #pragma multi-compile added in 5.6</span></p></li>
</ul>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="GraphicsCommandBuffers.html"></a></span><div class="tip"> Graphics Command Buffers</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="SparseTextures.html"></a></span><div class="tip">Sparse Textures</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">
<user_feedback><a href="LeaveFeedback.html" target="_blank">Leave feedback</a></user_feedback><known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="https://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues>Copyright © 2017 Unity Technologies. Publication: 2017.1-001Q. Built: 2017-08-29.</div>
<div class="menu">
<a href="https://unity3d.com/learn">Tutorials</a><a href="https://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="https://forum.unity3d.com">Forums</a><a href="https://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
</body>
</html>
